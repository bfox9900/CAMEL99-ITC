\ SQUOTE S" extension for Forth 2012 to include interpretation
\ SEE:  11.3.4 Other transient regions
\ This version will uses HEAP space
\ TI-99 low memory (starts at >2000)

\ *** LOAD THIS AT START OF PROGRAM IF YOU USE THE HEAP DYNAMICALLY
\ It needs the HEAP buffer forever once it is allocated
HEX
 VARIABLE $P                         \ string pool pointer
: POOL    ( -- addr) $P  @ ;          \ pool address
: PALLOT  ( n -- ) $P +!  $P @ 20FF AND $P !  ;  \ circular pool allocation

HEAP $P !  160 HALLOT    \ permantly assigns HEAP buffer to the string pool variable

: S"           ( -- )
               [CHAR] " PARSE   ( -- adr len)
               STATE @
               IF     COMPILE (S")   S,       \ standard action when COMPILING

               ELSE   POOL PLACE              \ place string in Pool $2000..
                      POOL COUNT              \ return the address and length
                      DUP 1+ ALIGNED  PALLOT  \ allocate the POOL memory. limit to >FF bytes
               THEN ; IMMEDIATE
